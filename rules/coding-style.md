# 编码风格

## 不可变性（关键原则）

**始终创建新对象，绝不修改现有对象：**

```
# 伪代码
错误:  modify(original, field, value) → 原地修改原对象
正确:  update(original, field, value) → 返回带有更改的新副本
```

**原因**：不可变数据防止隐藏的副作用，使调试更容易，并支持安全的并发。

## 文件组织

**多个小文件 > 少量大文件**：
- 高内聚，低耦合
- 每个文件 200-400 行，最多 800 行
- 从大型模块中提取工具函数
- 按功能/领域组织，而非按类型

## 错误处理

**始终全面处理错误**：
- 在每一层显式处理错误
- 在面向UI的代码中提供用户友好的错误消息
- 在服务器端记录详细的错误上下文
- 绝不静默吞掉错误

## 输入验证

**始终在系统边界验证**：
- 处理前验证所有用户输入
- 尽可能使用基于模式的验证
- 快速失败并给出清晰的错误消息
- 绝不信任外部数据（API响应、用户输入、文件内容）

## 代码质量检查清单

标记工作完成前检查：
- [ ] 代码可读且命名良好
- [ ] 函数短小（<50行）
- [ ] 文件专注（<800行）
- [ ] 无深层嵌套（>4层）
- [ ] 正确的错误处理
- [ ] 无硬编码值（使用常量或配置）
- [ ] 无修改（使用不可变模式）

## 命名规范

### Python
- 变量/函数：`snake_case`
- 类：`PascalCase`
- 常量：`UPPER_SNAKE_CASE`
- 私有：`_leading_underscore`

### R
- 变量/函数：`snake_case`
- 避免使用点号分隔（与S3方法冲突）
- 常量：`UPPER_SNAKE_CASE`

## 注释原则

- **好代码自解释**：优先写清晰的代码而非注释
- **解释"为什么"而非"是什么"**
- **保持同步**：代码修改时更新注释
- **避免废话注释**：`# 循环遍历列表` 这种注释无价值
