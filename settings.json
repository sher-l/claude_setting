{
  "env": {
    "ANTHROPIC_AUTH_TOKEN": "",
    "_comment_ANTHROPIC_BASE_URL": "https://open.bigmodel.cn/api/anthropic",
    "_comment_API_TIMEOUT_MS": "3000000",
    "_comment_CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC": "1",
    "_comment_CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1",
    "_comment_ANTHROPIC_DEFAULT_HAIKU_MODEL": "glm-5",
    "_comment_ANTHROPIC_DEFAULT_SONNET_MODEL": "glm-5",
    "_comment_ANTHROPIC_DEFAULT_OPUS_MODEL": "glm-5"
  },
  "model": "haiku",
  "enabledPlugins": {
    "glm-plan-bug@zai-coding-plugins": true,
    "glm-plan-usage@zai-coding-plugins": true,
    "oh-my-claudecode@omc": true
  },
  "hooks": {
    "PreToolUse": [
      {
        "_comment": "阻止随意创建 .md/.txt 文档文件",
        "matcher": "tool == \"Write\" && tool_input.file_path matches \"\\.(md|txt)$\" && !(tool_input.file_path matches \"README\\.md|CLAUDE\\.md|AGENTS\\.md|CONTRIBUTING\\.md|CHANGELOG\\.md\")",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"const fs=require('fs');let d='';process.stdin.on('data',c=>d+=c);process.stdin.on('end',()=>{const i=JSON.parse(d);const p=i.tool_input?.file_path||'';if(/\\.(md|txt)$/.test(p)&&!/(README|CLAUDE|AGENTS|CONTRIBUTING|CHANGELOG)\\.md$/.test(p)){console.error('[Hook] 已阻止: 不要创建随机文档文件');console.error('[Hook] 文件: '+p);console.error('[Hook] 请使用 README.md 或现有文档文件');process.exit(1)}console.log(d)})\""
          }
        ]
      },
      {
        "_comment": "git push 前提醒检查",
        "matcher": "tool == \"Bash\" && tool_input.command matches \"git push\"",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"console.error('[Hook] push 前请确认已检查变更...')\""
          }
        ]
      },
      {
        "_comment": "git commit 自动移除 Co-Authored-By",
        "matcher": "tool == \"Bash\" && tool_input.command matches \"git commit\"",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"let d='';process.stdin.on('data',c=>d+=c);process.stdin.on('end',()=>{const i=JSON.parse(d);let cmd=i.tool_input?.command||'';if(/Co-Authored-By:/i.test(cmd)){cmd=cmd.replace(/\\n?Co-Authored-By:[^\\n]*/gi,'').replace(/\\n\\n\\n/g,'\\n\\n');i.tool_input.command=cmd;console.error('[Hook] 已移除 Co-Authored-By 签名')}console.log(JSON.stringify(i))})\""
          }
        ]
      },
      {
        "_comment": "长时间命令建议使用 tmux",
        "matcher": "tool == \"Bash\" && tool_input.command matches \"(npm (install|test)|pip install|cargo build|make|docker|pytest|npm run)\"",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"if(!process.env.TMUX){console.error('[Hook] 建议在 tmux 中运行长时间命令');console.error('[Hook] tmux new -s dev | tmux attach -t dev')}\""
          }
        ]
      },
      {
        "_comment": "大文件写入警告",
        "matcher": "tool == \"Write\" || tool == \"Edit\"",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"let d='';process.stdin.on('data',c=>d+=c);process.stdin.on('end',()=>{const i=JSON.parse(d);const content=i.tool_input?.content||i.tool_input?.new_string||'';if(content.length>50000){console.error('[Hook] 警告: 写入内容超过50KB，考虑拆分文件')}console.log(d)})\""
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "_comment": "编辑 Python 文件后检查语法",
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\.py$\"",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"const{execSync}=require('child_process');const fs=require('fs');let d='';process.stdin.on('data',c=>d+=c);process.stdin.on('end',()=>{const i=JSON.parse(d);const p=i.tool_input?.file_path;if(p&&fs.existsSync(p)){try{execSync('python3 -m py_compile '+p,{stdio:'pipe'})}catch(e){const err=e.stderr?.toString()||e.message;console.error('[Hook] Python 语法错误:');console.error(err.split('\\n').slice(0,10).join('\\n'))}}console.log(d)})\""
          }
        ]
      },
      {
        "_comment": "编辑 R 文件后检查语法",
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\.R$\"",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"const{execSync}=require('child_process');const fs=require('fs');let d='';process.stdin.on('data',c=>d+=c);process.stdin.on('end',()=>{const i=JSON.parse(d);const p=i.tool_input?.file_path;if(p&&fs.existsSync(p)){try{execSync('Rscript -e \\\"parse(file=\\\\\\\"'+p+'\\\\\\\")\\\"',{stdio:'pipe'})}catch(e){console.error('[Hook] R 语法错误')}}console.log(d)})\""
          }
        ]
      },
      {
        "_comment": "检查代码中的敏感信息",
        "matcher": "tool == \"Edit\" || tool == \"Write\"",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"const fs=require('fs');let d='';process.stdin.on('data',c=>d+=c);process.stdin.on('end',()=>{const i=JSON.parse(d);const p=i.tool_input?.file_path;if(p&&fs.existsSync(p)){const c=fs.readFileSync(p,'utf8');const secrets=[/(sk-[a-zA-Z0-9]{20,})/g,/(api[_-]?key\\s*[:=]\\s*['\\\"])[^'\\\"]+(['\\\"])/gi,/(password\\s*[:=]\\s*['\\\"])[^'\\\"]+(['\\\"])/gi,/(token\\s*[:=]\\s*['\\\"])[^'\\\"]+(['\\\"])/gi];secrets.forEach(s=>{if(s.test(c)){console.error('[Hook] 警告: 可能包含敏感信息 '+p);console.error('[Hook] 请检查并使用环境变量替代硬编码的密钥')}})}console.log(d)})\""
          }
        ]
      },
      {
        "_comment": "检查代码中的 TODO/FIXME",
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\.(py|R|ts|js|tsx|jsx)$\"",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"const fs=require('fs');let d='';process.stdin.on('data',c=>d+=c);process.stdin.on('end',()=>{const i=JSON.parse(d);const p=i.tool_input?.file_path;if(p&&fs.existsSync(p)){const c=fs.readFileSync(p,'utf8');const todos=c.split('\\n').filter(l=>/TODO|FIXME|XXX|HACK/.test(l));if(todos.length>0){console.error('[Hook] 提醒: '+p+' 中有 '+todos.length+' 个 TODO/FIXME');todos.slice(0,3).forEach(t=>console.error('  '+t.trim()))}}console.log(d)})\""
          }
        ]
      },
      {
        "_comment": "检查 console.log/print 语句",
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\.(js|ts|tsx|jsx|py)$\"",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"const fs=require('fs');let d='';process.stdin.on('data',c=>d+=c);process.stdin.on('end',()=>{const i=JSON.parse(d);const p=i.tool_input?.file_path;if(p&&fs.existsSync(p)){const c=fs.readFileSync(p,'utf8');const logs=[];c.split('\\n').forEach((l,idx)=>{if(/console\\.(log|debug|info)|print\\s*\\(/.test(l)){logs.push((idx+1)+': '+l.trim())}});if(logs.length>0){console.error('[Hook] 警告: '+p+' 中有调试输出');logs.slice(0,3).forEach(l=>console.error('  '+l))}}console.log(d)})\""
          }
        ]
      },
      {
        "_comment": "PR 创建后显示链接",
        "matcher": "tool == \"Bash\"",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"let d='';process.stdin.on('data',c=>d+=c);process.stdin.on('end',()=>{const i=JSON.parse(d);const cmd=i.tool_input?.command||'';if(/gh pr create/.test(cmd)){const out=i.tool_output?.output||'';const m=out.match(/https:\\\\/\\\\/github.com\\\\/[^/]+\\\\/[^/]+\\\\/pull\\\\/\\\\d+/);if(m){console.error('[Hook] PR 已创建: '+m[0])}}console.log(d)})\""
          }
        ]
      }
    ],
    "Stop": [
      {
        "_comment": "会话结束时检查未提交的变更",
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"const{execSync}=require('child_process');try{const status=execSync('git status --porcelain',{encoding:'utf8',stdio:['pipe','pipe','pipe']});if(status.trim()){console.error('[Hook] 提醒: 有未提交的变更');console.error(status.trim().split('\\n').slice(0,5).join('\\n'))}}catch(e){}\""
          }
        ]
      },
      {
        "_comment": "会话结束时检查调试语句",
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "node -e \"const{execSync}=require('child_process');try{const diff=execSync('git diff --name-only HEAD',{encoding:'utf8',stdio:['pipe','pipe','pipe']});const files=diff.trim().split('\\n').filter(f=>/\\.(py|js|ts|R)$/.test(f));if(files.length>0){console.error('[Hook] 提醒: 提交前检查调试语句');files.slice(0,5).forEach(f=>console.error('  '+f))}}catch(e){}\""
          }
        ]
      }
    ]
  }
}
